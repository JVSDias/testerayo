<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Status do Usuário</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; }
  .info { margin-top: 1rem; }
  .foto { margin-top: 1rem; }
  .foto img { max-width: 200px; height: auto; border: 1px solid #ccc; }
</style>
</head>
<body>

<h1>Status do Usuário</h1>

<div id="result">Carregando...</div>

<script>    
// URL da planilha publicada (CSV)
const sheetCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTIIQqppQ_L_bzHaiZRIR5wO0lkgs-108O62oJDodI4EXlejA_v_UEMU9bXnJIHj4bxKhxDkzWN4U6x/pub?gid=0&single=true&output=csv';

// Função para pegar o parâmetro "id" da URL
function getIdFromUrl() {
  const params = new URLSearchParams(window.location.search);
  return params.get('id');
}

// Função para converter CSV em array de objetos
function csvToArray(str, delimiter = ',') {
  const lines = str.trim().split('\n');
  const headers = lines.shift().split(delimiter);
  return lines.map(line => {
    const data = line.split(delimiter);
    return headers.reduce((obj, header, i) => {
      obj[header.trim()] = data[i] ? data[i].trim() : '';
      return obj;
    }, {});
  });
}

// Função para transformar link do Google Drive em link direto
function transformarLinkGoogleDrive(link) {
  const regex = /\/d\/([a-zA-Z0-9_-]+)\//;
  const match = link.match(regex);
  if (match && match[1]) {
    return `https://drive.google.com/uc?export=view&id=${match[1]}`;
  }
  return ''; // Se não for um link válido, retorna vazio
}

// Função principal
async function showUserStatus() {
  const id = getIdFromUrl();
  const resultDiv = document.getElementById('result');
  if (!id) {
    resultDiv.innerText = 'Por favor, informe o ID na URL. Exemplo: ?id=1';
    return;
  }

  try {
    const response = await fetch(sheetCsvUrl);
    const csvText = await response.text();
    const data = csvToArray(csvText, '\t');  // Separador TAB (como está no seu exemplo)

    const user = data.find(u => u.ID === id);
    if (!user) {
      resultDiv.innerText = 'Membro não encontrado.';
      return;
    }

    // Transformar o link do Google Drive em um link direto
    const linkDireto = transformarLinkGoogleDrive(user.Foto);

    const imagemHtml = linkDireto ? `<div class="foto"><img src="${linkDireto}" alt="Foto de ${user.Nome}"></div>` : '';

    // Mostra os dados do usuário
    resultDiv.innerHTML = `
      <div class="info"><b>Nome:</b> ${user.Nome}</div>
      <div class="info"><b>Status:</b> ${user.Status}</div>
      <div class="info"><b>Validade:</b> ${user.Validade}</div>
      <div class="info"><b>RA:</b> ${user.RA}</div>
      ${imagemHtml}
    `;
  } catch (err) {
    console.error(err);
    resultDiv.innerText = 'Erro ao carregar os dados.';
  }
}

showUserStatus();
</script>

</body>
</html>
